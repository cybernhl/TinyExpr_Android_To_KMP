# TinyExpr Android to KMP

[ç¹é«”ä¸­æ–‡](#ç¹é«”ä¸­æ–‡) | [English](#english)

---

## ç¹é«”ä¸­æ–‡

### å°ˆæ¡ˆç°¡ä»‹
æœ¬å°ˆæ¡ˆç›®æ¨™æ˜¯ç ”ç©¶ **Kotlin Multiplatform (KMP)** å¦‚ä½•åœ¨ **Android / JVM / iOS** å¹³å°ä¸­å…±ç”¨ **C / JNI** å‡½å¼åº«ã€‚

ç¯„ä¾‹ä½¿ç”¨äº† [tinyexpr](https://github.com/codeplea/tinyexpr) é€™å€‹è¼•é‡ç´š C èªè¨€æ•¸å­¸è¡¨é”å¼è§£æå™¨ï¼Œä¸¦é€é **Gradle + CMake** è‡ªå‹•åŒ–ç·¨è­¯ï¼Œå˜—è©¦ç”¢ç”Ÿå„å¹³å°å¯ç”¨çš„äºŒé€²ä½æª”æ¡ˆã€‚

åŸå§‹åƒè€ƒæ–‡ç« èˆ‡å°ˆæ¡ˆï¼š
- ğŸ“– [KMP Native C/C++ by Adman Shadman](https://medium.com/@adman.shadman/kmp-native-c-c-a7b62e4e9c1f)
- ğŸ’» [shadmanadman/KMP-TinyExpr](https://github.com/shadmanadman/KMP-TinyExpr)

èˆ‡å…¶å°‡ C åŸå§‹ç¢¼æ‰‹å‹•è¤‡è£½ï¼Œé€™è£¡æ”¹ç”¨ **Git Submodule** çš„æ–¹å¼å¼•å…¥ tinyexprï¼Œæ–¹ä¾¿ç¶­è­·èˆ‡æ›´æ–°ã€‚

---

### ç‰¹è‰²
- ğŸŒ Kotlin Multiplatform: Android / JVM / iOS
- ğŸ”— ä½¿ç”¨ Git Submodule å¼•å…¥ [tinyexpr](https://github.com/codeplea/tinyexpr)
- âš™ï¸ ä½¿ç”¨ Gradle èˆ‡ CMake å»ºç½®å„å¹³å°äºŒé€²ä½
- ğŸ“¦ ç¯„ä¾‹ JNI å°è£ï¼Œæä¾› JVM èˆ‡ Android ä½¿ç”¨
- ğŸ iOS å¹³å°è¼¸å‡º `.a` éœæ…‹å‡½å¼åº«

---

### å°ˆæ¡ˆçµæ§‹
```plaintext
TinyExpr_Android_To_KMP/
 â”œâ”€ shared/                # KMP å…±ç”¨æ¨¡çµ„
 â”‚   â”œâ”€ build.gradle.kts   # Gradle èˆ‡ CMake è¨­å®š
 â”‚   â”œâ”€ src/               # Kotlin å…±ç”¨ç¨‹å¼ç¢¼
 â”‚   â””â”€ native/            # CMake è¼¸å‡ºçš„ç”¢ç‰©
 â”œâ”€ tinyexpr/              # é€é Git Submodule å¼•å…¥
 â””â”€ ...
```

---

### å»ºç½®æ–¹å¼

#### 1. ä¸‹è¼‰å°ˆæ¡ˆï¼ˆåŒ…å« Submoduleï¼‰
```bash
git clone --recurse-submodules https://github.com/cybernhl/TinyExpr_Android_To_KMP.git
```

è‹¥å·²ç¶“ clone éï¼Œè«‹åŸ·è¡Œï¼š
```bash
git submodule update --init --recursive
```

#### 2. ç·¨è­¯
å°ˆæ¡ˆæœƒä¾ç…§å¹³å°è¼¸å‡ºå°æ‡‰çš„äºŒé€²ä½æª”æ¡ˆï¼š
- Android â†’ `.so`
- JVM â†’ `.dylib` / `.so`
- iOS â†’ `.a`

å¯ç›´æ¥é€é **Gradle** é€²è¡Œå»ºç½®ï¼š
```bash
./gradlew build
```

---

### åƒè€ƒ
- [tinyexpr åŸå§‹ç¢¼](https://github.com/codeplea/tinyexpr)
- [KMP-TinyExpr ç¯„ä¾‹](https://github.com/shadmanadman/KMP-TinyExpr)
- [KMP Native C/C++ æ•™å­¸æ–‡ç« ](https://medium.com/@adman.shadman/kmp-native-c-c-a7b62e4e9c1f)

---

## English

### Overview
This project demonstrates how **Kotlin Multiplatform (KMP)** can integrate **C / JNI** libraries across **Android / JVM / iOS** platforms.

We use [tinyexpr](https://github.com/codeplea/tinyexpr), a lightweight C math expression parser, and build it via **Gradle + CMake** to generate native binaries for each platform.

Original references:
- ğŸ“– [KMP Native C/C++ by Adman Shadman](https://medium.com/@adman.shadman/kmp-native-c-c-a7b62e4e9c1f)
- ğŸ’» [shadmanadman/KMP-TinyExpr](https://github.com/shadmanadman/KMP-TinyExpr)

Instead of manually copying source files, this project uses a **Git Submodule** to include tinyexpr, making updates easier.

---

### Features
- ğŸŒ Kotlin Multiplatform: Android / JVM / iOS
- ğŸ”— Include [tinyexpr](https://github.com/codeplea/tinyexpr) via Git Submodule
- âš™ï¸ Build native binaries with Gradle + CMake
- ğŸ“¦ JNI wrapper example for JVM / Android
- ğŸ iOS static library (`.a`) support

---

### Project Structure
```plaintext
TinyExpr_Android_To_KMP/
 â”œâ”€ shared/                # KMP shared module
 â”‚   â”œâ”€ build.gradle.kts   # Gradle & CMake configuration
 â”‚   â”œâ”€ src/               # Shared Kotlin code
 â”‚   â””â”€ native/            # CMake build outputs
 â”œâ”€ tinyexpr/              # Git submodule
 â””â”€ ...
```

---

### Build Instructions

#### 1. Clone repository with submodules
```bash
git clone --recurse-submodules https://github.com/cybernhl/TinyExpr_Android_To_KMP.git
```

If already cloned:
```bash
git submodule update --init --recursive
```

#### 2. Build
The project generates binaries for different targets:
- Android â†’ `.so`
- JVM â†’ `.dylib` / `.so`
- iOS â†’ `.a`

Run Gradle build:
```bash
./gradlew build
```

---

### References
- [tinyexpr source](https://github.com/codeplea/tinyexpr)
- [KMP-TinyExpr example](https://github.com/shadmanadman/KMP-TinyExpr)
- [KMP Native C/C++ tutorial](https://medium.com/@adman.shadman/kmp-native-c-c-a7b62e4e9c1f)  
